<div class="page-container">

  <!-- 
    1. ÿπÿ∑ŸäŸÜÿß ÿßŸÑÿ≥ÿßŸäÿØ ÿ®ÿßÿ± ÿßÿ≥ŸÖ ŸÖÿ±ÿ¨ÿπŸä #sidebarRef 
    ÿØŸá ÿ®ŸäÿÆŸÑŸäŸÜÿß ŸÜŸÇÿØÿ± ŸÜÿ¥ŸàŸÅ ÿßŸÑŸÖÿ™ÿ∫Ÿäÿ±ÿßÿ™ ÿßŸÑŸÑŸä ÿ¨ŸàÿßŸá (ÿ≤Ÿä isSidebarExpanded) ŸÖÿ®ÿßÿ¥ÿ±ÿ© ŸáŸÜÿß
  -->
  <app-sidebar #sidebarRef class="sidebar"></app-sidebar>

  <!-- 
    2. ÿßÿ≥ÿ™ÿÆÿØŸÖŸÜÿß ÿßŸÑŸÖÿ™ÿ∫Ÿäÿ± ÿßŸÑŸÖÿ±ÿ¨ÿπŸä ÿØŸá ÿπÿ¥ÿßŸÜ ŸÜÿ™ÿ≠ŸÉŸÖ ŸÅŸä ŸÉŸÑÿßÿ≥ÿßÿ™ ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ 
    ŸÑÿßÿ≠ÿ∏: !sidebarRef.isSidebarExpanded ÿ®ÿØŸÑ ŸÖÿß ŸÜŸÉÿ™ÿ® ŸÉŸàÿØ ŸÅŸä ÿßŸÑŸÄ TS
  -->
  <main class="main-content" [class.collapsed]="!sidebarRef.isSidebarExpanded">

    <div class="cards-container">
      <div *ngFor="let card of cards" class="energy-card" [ngClass]="card.type">
        <div class="icon-wrapper">{{card.icon}}</div>
        <div class="card-content">
          <h3>{{card.title}}</h3>
          <div class="value">
            <h1>{{card.value}}</h1>
          </div>
          <p>{{card.subvalue}}</p>
        </div>
      </div>
    </div>

    <div class="chart-section" *ngIf="chartOptions">
      <div class="header-section">
        <h3>Hourly Usage</h3>
        <span class="badge">Last 24 Hours</span>
      </div>

      <div id="chart">
        <apx-chart [series]="chartOptions.series" [chart]="chartOptions.chart" [dataLabels]="chartOptions.dataLabels"
          [plotOptions]="chartOptions.plotOptions" [yaxis]="chartOptions.yaxis" [xaxis]="chartOptions.xaxis"
          [legend]="chartOptions.legend" [colors]="chartOptions.colors" [grid]="chartOptions.grid"
          [fill]="chartOptions.fill" [tooltip]="chartOptions.tooltip"></apx-chart>
      </div>
      <div class="peak-usage">
        <div class="usage-icon">üìà</div>
        <div class="usage-content">
          <h3>Peak Usage: 2 PM - 6 PM</h3>
          <p>Consider shifting high-power activities to off-peak hours.</p>
        </div>
      </div>
    </div>
    <div class="actions-section">

      <div class="header-section">
        <h3 class="section-title">AI Insights</h3>
        <span class="badge-count">{{ actions.length }} Actions</span>
      </div>

      <div class="actions-list">

        <div *ngFor="let item of actions" class="action-card" [ngClass]="'type-' + item.type">
          <div class="card-top">
            <div class="icon-box">
              ‚ö†Ô∏è
            </div>
            <div class="text-content">
              <h3 class="title">{{ item.title }}</h3>
              <p class="description">{{ item.description }}</p>
            </div>
          </div>

          <div class="divider"></div>

          <div class="card-bottom">
            <div class="savings-badge">
              üí∞ {{ item.savingsAmount }}
            </div>
            <button class="action-btn" (click)="onActionClick(item)">
              {{ item.actionButtonText }}
            </button>
          </div>


        </div>
       

      </div>
       <div class="eco-card">
          <div class="eco-icon">üåø</div>
          <h3>Activate Eco Mode</h3>
          <p>Automatically optimize all devices for maximum energy efficiency</p>
          <button class="eco-btn">Enable Eco Mode</button>
        </div>
    </div>
    <!-- 3. NEW SECTION: Energy Hungry Devices List -->
    <div class="device-ranking-section">
      <div class="header-section">
        <h3>Energy Hungry Devices</h3>
        <span class="subtitle">Ranked by consumption</span>
      </div>

      <div class="ranking-list">
        <div *ngFor="let device of sortedDevices; let i = index" class="rank-item" [class.rank-one]="i === 0">
          
          <!-- Rank # -->
          <div class="rank-badge">#{{ i + 1 }}</div>

          <!-- Icon -->
          <div class="device-icon-box">{{ getDeviceIcon(device.type) }}</div>

          <!-- Info & Progress -->
          <div class="device-details">
            <div class="device-title-row">
              <h4>{{ device.name }}</h4>
              <span class="device-meta">üìç {{ device.room }} ‚Ä¢ {{ device.consumption }} kW/h</span>
            </div>
            <div class="progress-track">
              <div class="progress-fill" [style.width.%]="getPercentage(device.consumption)"></div>
            </div>
          </div>

          <!-- Stats -->
          <div class="device-stats">
            <span class="percent-text">{{ getPercentage(device.consumption) | number:'1.0-0' }}%</span>
            <span class="cost-text">AED {{ getCost(device.consumption) | number:'1.0-0' }}</span>
          </div>

        </div>
      </div>
    </div>



  </main>
</div>